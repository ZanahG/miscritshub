<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Team Builder • Miscrits HUB</title>

  <link rel="icon" href="../assets/images/logo.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="../assets/images/logo.png" />

  <link rel="stylesheet" href="../css/global.css" />
  <link rel="stylesheet" href="../css/navbar.css" />
  <link rel="stylesheet" href="../css/team_builder.css" />

  <script defer src="../js/navbar.js"></script>
  <script type="module" defer src="../js/teambuilder.js"></script>
</head>

<body>
  <!-- NAVBAR -->
  <header class="nav">
    <div class="nav__inner">
      <a class="nav__brand" href="../index.html" aria-label="Go home">
        <img src="../assets/images/logo.png" alt="Miscrits HUB" class="nav__logo" />
        <span class="nav__brandText">Miscrits HUB</span>
      </a>

      <button class="nav__toggle" type="button" aria-label="Open menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="nav__menu" aria-label="Main navigation">
        <a class="nav__link" href="./spawns.html">Spawns</a>
        <a class="nav__link" href="./miscripedia.html">Miscripedia</a>

        <div class="nav__dropdown" data-dropdown>
          <button class="nav__link nav__dropBtn" type="button" aria-haspopup="true" aria-expanded="false">
            PVP <span class="nav__chev" aria-hidden="true">▾</span>
          </button>
          <div class="nav__dropMenu" role="menu">
            <a role="menuitem" class="nav__dropItem" href="./team-builder.html">Team Builder</a>
            <a role="menuitem" class="nav__dropItem" href="./damage-calculator.html">Damage Calculator</a>
            <a role="menuitem" class="nav__dropItem" href="./pvp_teams.html">PVP Teams</a>
          </div>
        </div>

        <div class="nav__dropdown" data-dropdown>
          <button class="nav__link nav__dropBtn" type="button" aria-haspopup="true" aria-expanded="false">
            Tools <span class="nav__chev" aria-hidden="true">▾</span>
          </button>
          <div class="nav__dropMenu" role="menu">
            <a role="menuitem" class="nav__dropItem" href="./stats_calculator.html">Stats Calculator</a>
            <a role="menuitem" class="nav__dropItem" href="./breeding_calculator.html">Breeding Calculator</a>
          </div>
        </div>

        <a class="nav__link" href="./miscritdle.html">Miscritdle</a>
        <a class="nav__link" href="./patch_notes.html">Patch notes</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="wrap tb">

    <!-- Top header / summary -->
    <section class="tbHead card">
      <div class="tbHead__left">
        <p class="tbHead__kicker">PVP Toolkit</p>
        <h1 class="tbHead__title">Team Builder</h1>
        <p class="tbHead__sub">
          Build your 12-point team, set bonus & relics, check coverage, and export/share.
        </p>

        <div class="tbHead__chips">
          <span class="chip">Cap: 12 pts</span>
          <span class="chip">Level: 35</span>
          <span class="chip">4 slots</span>
        </div>
      </div>

      <!-- Compact actions only -->
      <div class="tbHead__right">
        <div class="tbPoints card" id="tbPointsPill" aria-label="Points summary">
          <div class="tbPoints__label">Points</div>
          <div class="tbPoints__row">
            <div class="tbPoints__num"><span id="tbUsed">0</span><span class="tbPoints__dim">/12</span></div>
            <div class="tbPoints__left"><span id="tbLeft">12</span> left</div>
          </div>
        </div>

        <div class="tbTopActions tbTopActions--compact">
          <button class="btn" id="tbClearAll" type="button">Clear All</button>
          <button class="btn btn--accent" id="tbExportImgBtn" type="button">Export Image</button>
        </div>
      </div>
    </section>

    <!-- Error banner -->
    <section id="tbError" class="tbError card" hidden></section>

    <!-- BUILD + ANALYZE (Option B) -->
    <section class="tbGrid">

      <!-- STEP 1: BUILD -->
      <div class="tbCol">
        <div class="tbPanel card">
          <div class="tbPanel__head">
            <h2 class="tbPanel__title">Step 1 — Build your team</h2>
            <div class="tbPanel__desc">Pick 4 Miscrits and configure each slot (Bonus & Relics).</div>
          </div>

          <div id="tbSlots" class="tbSlots"></div>
        </div>

        <!-- STEP 2: ANALYZE (Locked until team complete) -->
        <details class="tbSection card" id="tbAnalyzeSection">
          <summary class="tbSection__sum">
            <div>
              <div class="tbSection__kicker">Step 2</div>
              <div class="tbSection__title">Analyze</div>
              <div class="tbSection__sub" id="tbAnalyzeHint">Complete 4 slots to unlock analysis.</div>
            </div>
            <span class="tbSection__chev">▾</span>
          </summary>

          <div class="tbSection__body" id="tbAnalyzeBody" hidden>

            <!-- Overview -->
            <div class="tbPanel card">
              <div class="tbPanel__head">
                <h2 class="tbPanel__title">Overview</h2>
                <div class="tbPanel__desc">Health + weaknesses + coverage gaps.</div>
              </div>

              <div class="tbEC">
                <div class="tbEC__box">
                  <div class="tbEC__label">Weakness (not covered)</div>
                  <div id="tbWeakBox" class="tb-els"></div>
                </div>

                <div class="tbEC__box">
                  <div class="tbEC__label">Not covered</div>
                  <div id="tbNotCoveredBox" class="tb-els"></div>
                </div>
              </div>

              <div class="tbDivider"></div>

              <div class="tbEC__label">Team health</div>
              <div id="tbHealth" class="tbHealth"></div>
            </div>

            <!-- Coverage by slot -->
            <details class="tbSubDetails">
              <summary class="tbSubDetails__sum">Coverage by slot</summary>
              <div class="tbSubDetails__body">
                <div id="tbCoveredBySlot" class="tbCoveredBySlot"></div>
              </div>
            </details>

            <!-- Quick check (moved inside Analyze) -->
            <details class="tbSubDetails">
              <summary class="tbSubDetails__sum">Quick check</summary>
              <div class="tbSubDetails__body">
                <div class="tbQuick">
                  <div class="tbQuick__row">
                    <label class="tbLabel" for="tbAtkSlot">Attacker</label>
                    <select id="tbAtkSlot" class="tbSelect">
                      <option value="0">Slot 1</option>
                      <option value="1">Slot 2</option>
                      <option value="2">Slot 3</option>
                      <option value="3">Slot 4</option>
                    </select>

                    <label class="tbLabel" for="tbMode">Mode</label>
                    <select id="tbMode" class="tbSelect">
                      <option value="auto" selected>Auto</option>
                      <option value="elemental">Elemental</option>
                      <option value="physical">Physical</option>
                    </select>
                  </div>

                  <div class="miscritpicker tbQuick__search">
                    <label class="tbLabel" for="tbThreatSearch">Enemy</label>
                    <input id="tbThreatSearch" class="tbInput" type="text" placeholder="Search Miscrit…" autocomplete="off" />
                    <div id="tbThreatDropdown" class="tbDropdown card" hidden></div>
                  </div>

                  <div class="tbQuickOut card">
                    <div class="tbQuickOut__grid">
                      <div>
                        <div class="tbMiniLabel">Attacker</div>
                        <div class="tbMono" id="tbOutAtk">—</div>
                      </div>
                      <div>
                        <div class="tbMiniLabel">Defender</div>
                        <div class="tbMono" id="tbOutDef">—</div>
                      </div>
                      <div>
                        <div class="tbMiniLabel">Best move</div>
                        <div class="tbMono" id="tbOutMove">—</div>
                      </div>
                      <div>
                        <div class="tbMiniLabel">HTK</div>
                        <div class="tbMono" id="tbOutHtk">—</div>
                      </div>
                      <div>
                        <div class="tbMiniLabel">Damage</div>
                        <div class="tbMono" id="tbOutRange">—</div>
                      </div>
                      <div>
                        <div class="tbMiniLabel">Average</div>
                        <div class="tbMono" id="tbOutAvg">—</div>
                      </div>
                      <div>
                        <div class="tbMiniLabel">Multiplier</div>
                        <div class="tbMono" id="tbOutMul">—</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </details>

            <!-- Threat analyzer -->
            <details class="tbSubDetails">
              <summary class="tbSubDetails__sum">Threat analyzer</summary>
              <div class="tbSubDetails__body">
                <div class="tbThreatTop">
                  <label class="tbCheck">
                    <input id="tbShowOnlyLoses" type="checkbox" />
                    <span>Show only loses</span>
                  </label>

                  <div class="tbThreatBtns">
                    <button class="btn btn--accent" id="tbAnalyzeThreats" type="button">Analyze</button>
                    <button class="btn" id="tbClearThreats" type="button">Clear</button>
                  </div>
                </div>

                <div id="tbThreatsBox" class="tbThreats"></div>
              </div>
            </details>

          </div>
        </details>

        <!-- OPTIONAL: ADVANCED TOOLS -->
        <details class="tbSection card">
          <summary class="tbSection__sum">
            <div>
              <div class="tbSection__kicker">Optional</div>
              <div class="tbSection__title">Advanced tools</div>
              <div class="tbSection__sub">Import/Export, share, saved teams.</div>
            </div>
            <span class="tbSection__chev">▾</span>
          </summary>

          <div class="tbSection__body">
            <div class="tbTopActions">
              <button class="btn" id="tbExportBtn" type="button">Export JSON</button>
              <button class="btn" id="tbImportBtn" type="button">Import JSON</button>
              <button class="btn" id="tbCopyLinkBtn" type="button">Copy Share Link</button>
            </div>

            <div class="tbDivider"></div>

            <div class="tbSaved card">
              <div class="tbSaved__top">
                <div class="tbSaved__title">Saved teams</div>
                <div class="tbSaved__hint">LocalStorage</div>
              </div>
              <div class="tbSaved__row">
                <select id="tbSavedSelect" class="tbSelect" aria-label="Saved teams selector">
                  <option value="">Saved Teams…</option>
                </select>
                <button class="btn" id="tbLoadSavedBtn" type="button">Load</button>
                <button class="btn" id="tbSaveTeamBtn" type="button">Save</button>
                <button class="btn" id="tbDeleteSavedBtn" type="button">Delete</button>
              </div>
            </div>
          </div>
        </details>
      </div>

      <!-- Right column intentionally empty (keeps your existing grid structure).
           If you prefer true 1-column, handle it in CSS. -->
      <div class="tbCol"></div>
    </section>
  </main>

  <!-- TOAST -->
  <div id="tbToast" class="tbToast" hidden></div>

  <!-- =========================
       PICKER MODAL
  ========================== -->
  <div id="tbPickerModal" class="tbModal" hidden>
    <div class="tbModal__panel card" role="dialog" aria-modal="true" aria-labelledby="tbPickerTitle">
      <div class="tbModal__head">
        <div>
          <div id="tbPickerTitle" class="tbModal__title">Pick Miscrit</div>
          <div class="tbModal__sub">Search and pick a Miscrit for your slot.</div>
        </div>
        <button class="tbIconBtn" id="tbPickerClose" type="button" aria-label="Close">✕</button>
      </div>

      <div class="tbModal__tools">
        <input id="tbPickerSearch" class="tbInput" type="text" placeholder="Search…" autocomplete="off" />
        <label class="tbCheck">
          <input id="tbOnlyAffordable" type="checkbox" />
          <span>Only affordable</span>
        </label>
      </div>

      <div id="tbPickerGrid" class="tbPickerGrid"></div>
    </div>
  </div>

  <!-- =========================
       BONUS & RELICS MODAL
  ========================== -->
  <div id="tbBRModal" class="tbModal" hidden>
    <div class="tbModal__panel card tbBR" role="dialog" aria-modal="true" aria-labelledby="tbBRTitle">
      <div class="tbModal__head">
        <div>
          <div id="tbBRTitle" class="tbModal__title">Bonus & Relics</div>
          <div id="tbBRSub" class="tbModal__sub">—</div>
        </div>
        <button class="tbIconBtn" id="tbBRClose" type="button" aria-label="Close">✕</button>
      </div>

      <div class="tbBR__grid">
        <div class="tbBR__col">
          <div class="tbBR__sectionTitle">Bonus points</div>
          <div class="tbBRForm">
            <label class="tbField"><span>HP</span><input id="tbBR_HP" class="tbInput" inputmode="numeric" value="0" /></label>
            <label class="tbField"><span>SPD</span><input id="tbBR_SPD" class="tbInput" inputmode="numeric" value="0" /></label>
            <label class="tbField"><span>EA</span><input id="tbBR_EA" class="tbInput" inputmode="numeric" value="0" /></label>
            <label class="tbField"><span>PA</span><input id="tbBR_PA" class="tbInput" inputmode="numeric" value="0" /></label>
            <label class="tbField"><span>ED</span><input id="tbBR_ED" class="tbInput" inputmode="numeric" value="0" /></label>
            <label class="tbField"><span>PD</span><input id="tbBR_PD" class="tbInput" inputmode="numeric" value="0" /></label>
          </div>

          <div class="tbDivider"></div>

          <div class="tbBR__sectionTitle">Color presets</div>
          <div class="tbBRPresets">
            <button class="btn" id="tbBRAllGreen" type="button">All green</button>
            <button class="btn" id="tbBRRS" type="button">RS (SPD red)</button>
          </div>

          <div class="tbDivider"></div>

          <div class="tbBR__sectionTitle">Relic bonus preview</div>
          <div id="tbBRRelicPreview" class="tbBRKV card"></div>
        </div>

        <div class="tbBR__col">
          <div class="tbBR__sectionTitle">Relics</div>

          <!-- Hidden inputs used by JS -->
          <div class="tbRelicInputs">
            <input id="tbBR_R1" list="tbRelicsLvl10" class="tbInput" placeholder="Lvl 10 relic key…" />
            <input id="tbBR_R2" list="tbRelicsLvl20" class="tbInput" placeholder="Lvl 20 relic key…" />
            <input id="tbBR_R3" list="tbRelicsLvl30" class="tbInput" placeholder="Lvl 30 relic key…" />
            <input id="tbBR_R4" list="tbRelicsLvl35" class="tbInput" placeholder="Lvl 35 relic key…" />
          </div>

          <datalist id="tbRelicsLvl10"></datalist>
          <datalist id="tbRelicsLvl20"></datalist>
          <datalist id="tbRelicsLvl30"></datalist>
          <datalist id="tbRelicsLvl35"></datalist>

          <div class="tbRelicSlots">
            <button class="tbRelicSlot card" type="button" data-rslot="0">
              <img class="tbRelicSlot__img" src="../assets/images/relics/CRUZ.png" alt="" />
              <div class="tbRelicSlot__meta">
                <div class="tbRelicSlot__lvl">Lvl 10</div>
                <div class="tbRelicSlot__hint">Click to pick</div>
              </div>
            </button>

            <button class="tbRelicSlot card" type="button" data-rslot="1">
              <img class="tbRelicSlot__img" src="../assets/images/relics/CRUZ.png" alt="" />
              <div class="tbRelicSlot__meta">
                <div class="tbRelicSlot__lvl">Lvl 20</div>
                <div class="tbRelicSlot__hint">Click to pick</div>
              </div>
            </button>

            <button class="tbRelicSlot card" type="button" data-rslot="2">
              <img class="tbRelicSlot__img" src="../assets/images/relics/CRUZ.png" alt="" />
              <div class="tbRelicSlot__meta">
                <div class="tbRelicSlot__lvl">Lvl 30</div>
                <div class="tbRelicSlot__hint">Click to pick</div>
              </div>
            </button>

            <button class="tbRelicSlot card" type="button" data-rslot="3">
              <img class="tbRelicSlot__img" src="../assets/images/relics/CRUZ.png" alt="" />
              <div class="tbRelicSlot__meta">
                <div class="tbRelicSlot__lvl">Lvl 35</div>
                <div class="tbRelicSlot__hint">Click to pick</div>
              </div>
            </button>
          </div>

          <div class="tbDivider"></div>

          <div class="tbBR__sectionTitle">Final stats (preview)</div>
          <div id="tbBRFinalStats" class="tbBRKV card"></div>

          <div class="tbBR__actions">
            <button class="btn" id="tbBRReset" type="button">Reset</button>
            <button class="btn btn--accent" id="tbBRApply" type="button">Apply</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       RELIC PICKER MODAL
  ========================== -->
  <div id="tbRelicModal" class="tbModal" hidden>
    <div class="tbModal__panel card" role="dialog" aria-modal="true" aria-labelledby="tbRelicModalTitle">
      <div class="tbModal__head">
        <div>
          <div id="tbRelicModalTitle" class="tbModal__title">Relics</div>
          <div class="tbModal__sub">Pick a relic for this slot level.</div>
        </div>
        <button class="tbIconBtn" id="tbRelicClose" type="button" aria-label="Close">✕</button>
      </div>

      <div class="tbModal__tools">
        <input id="tbRelicSearch" class="tbInput" type="text" placeholder="Search relic…" autocomplete="off" />
        <button class="btn" data-action="tbRelicClose" type="button">Close</button>
      </div>

      <div id="tbRelicGrid" class="tbRelicGrid"></div>
    </div>
  </div>

  <!-- =========================
       IMPORT MODAL
  ========================== -->
  <div id="tbImportModal" class="tbModal" hidden>
    <div class="tbModal__panel card" role="dialog" aria-modal="true" aria-labelledby="tbImportTitle">
      <div class="tbModal__head">
        <div>
          <div id="tbImportTitle" class="tbModal__title">Import Team JSON</div>
          <div class="tbModal__sub">Paste exported JSON and apply.</div>
        </div>
        <button class="tbIconBtn" id="tbImportClose" type="button" aria-label="Close">✕</button>
      </div>

      <textarea id="tbImportText" class="tbTextarea" placeholder="{ ... }"></textarea>

      <div class="tbModal__foot">
        <button class="btn" id="tbImportCancel" type="button">Cancel</button>
        <button class="btn btn--accent" id="tbImportApply" type="button">Apply</button>
      </div>
    </div>
  </div>

  <!-- =========================
       IMG EXPORT MODAL
  ========================== -->
  <div id="tbImgModal" class="tbModal" hidden>
    <div class="tbModal__panel card tbImg" role="dialog" aria-modal="true" aria-labelledby="tbImgTitle">
      <div class="tbModal__head">
        <div>
          <div id="tbImgTitle" class="tbModal__title">Export Image</div>
          <div class="tbModal__sub">Pick background and tweak layout, then download.</div>
        </div>
        <button class="tbIconBtn" id="tbImgClose" type="button" aria-label="Close">✕</button>
      </div>

      <div class="tbImg__grid">
        <div class="tbImg__canvas card">
          <canvas id="tbImgCanvas" width="1536" height="1024"></canvas>
        </div>

        <div class="tbImg__controls">
          <label class="tbField">
            <span>Team name</span>
            <input id="tbImgTeamName" class="tbInput" type="text" value="TEAM NAME" />
          </label>

          <label class="tbField">
            <span>Background</span>
            <select id="tbImgBg" class="tbSelect"></select>
          </label>

          <div class="tbDivider"></div>

          <div class="tbRanges">
            <div class="tbRange">
              <div class="tbRange__top"><span>Title Y</span><b id="v_tbImg_titleY"></b></div>
              <input id="tbImg_titleY" type="range" min="60" max="260" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Title size</span><b id="v_tbImg_titleSize"></b></div>
              <input id="tbImg_titleSize" type="range" min="54" max="140" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Avatar Y</span><b id="v_tbImg_avatarY"></b></div>
              <input id="tbImg_avatarY" type="range" min="160" max="420" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Avatar size</span><b id="v_tbImg_avatarSize"></b></div>
              <input id="tbImg_avatarSize" type="range" min="90" max="220" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Avatar gap</span><b id="v_tbImg_avatarGap"></b></div>
              <input id="tbImg_avatarGap" type="range" min="50" max="180" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Badge Y</span><b id="v_tbImg_badgeY"></b></div>
              <input id="tbImg_badgeY" type="range" min="120" max="320" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Badge size</span><b id="v_tbImg_badgeSize"></b></div>
              <input id="tbImg_badgeSize" type="range" min="24" max="90" step="1" />
            </div>

            <div class="tbDivider"></div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Type label X</span><b id="v_tbImg_typeX"></b></div>
              <input id="tbImg_typeX" type="range" min="20" max="240" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Weakness Y</span><b id="v_tbImg_weakY"></b></div>
              <input id="tbImg_weakY" type="range" min="520" max="880" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Coverage Y</span><b id="v_tbImg_covY"></b></div>
              <input id="tbImg_covY" type="range" min="620" max="980" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Type icon radius</span><b id="v_tbImg_typeIconR"></b></div>
              <input id="tbImg_typeIconR" type="range" min="10" max="30" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Type icon step</span><b id="v_tbImg_typeIconStep"></b></div>
              <input id="tbImg_typeIconStep" type="range" min="22" max="70" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Coverage offset Y</span><b id="v_tbImg_covOffsetY"></b></div>
              <input id="tbImg_covOffsetY" type="range" min="-120" max="120" step="1" />
            </div>

            <div class="tbDivider"></div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Relic icon radius</span><b id="v_tbImg_iconR"></b></div>
              <input id="tbImg_iconR" type="range" min="18" max="46" step="1" />
            </div>

            <div class="tbRange">
              <div class="tbRange__top"><span>Relic icon step</span><b id="v_tbImg_iconStep"></b></div>
              <input id="tbImg_iconStep" type="range" min="30" max="90" step="1" />
            </div>
          </div>

          <div class="tbImg__actions">
            <button class="btn" id="tbImgReset" type="button">Reset</button>
            <button class="btn btn--accent" id="tbImgDownload" type="button">Download PNG</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
